# é—ªç”µå…‘æ¢å¥—åˆ©ç³»ç»Ÿå®ç°æŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªåŸºäºUniswap V2çš„é—ªç”µå…‘æ¢å¥—åˆ©ç³»ç»Ÿï¼Œåœ¨Sepoliaæµ‹è¯•ç½‘ä¸Šéƒ¨ç½²äº†å®Œæ•´çš„DeFiåŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªERC20ä»£å¸ã€ä¸¤ä¸ªUniswapå®ä¾‹å’Œå¥—åˆ©åˆçº¦ã€‚

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„è¦æ±‚

1. **åœ¨æµ‹è¯•ç½‘ä¸Šéƒ¨ç½²ä¸¤ä¸ªè‡ªå·±çš„ERC20åˆçº¦**
   - Token A (TKA): `0xB74b65845A9b66a870B2D67a58fc80aE17014713`
   - Token B (TKB): `0x2Df21BbDd03AB078b012C2d51798620C16604959`

2. **éƒ¨ç½²ä¸¤ä¸ªUniswapå®ä¾‹å¹¶åˆ›å»ºæµåŠ¨æ± **
   - PoolA: 1000 TKA + 2000 TKB (ä»·æ ¼æ¯”ä¾‹ 1:2)
   - PoolB: 1000 TKA + 1800 TKB (ä»·æ ¼æ¯”ä¾‹ 1:1.8)
   - æˆåŠŸåˆ›é€ äº†ä»·å·®å¥—åˆ©æ¡ä»¶

3. **ç¼–å†™é—ªç”µå…‘æ¢å¥—åˆ©åˆçº¦**
   - FlashSwapArbitrage: `0x44525F8d9ed3dC23919D88FC4B4383288c17b8De7`
   - åŸºäºUniswap V2çš„ExampleFlashSwapå®ç°
   - å®ç°äº†å®Œæ•´çš„é—ªç”µè´·å’Œå¥—åˆ©é€»è¾‘

4. **æä¾›ä»£ç åº“é“¾æ¥**
   - GitHubä»“åº“: https://github.com/cuidaquan/hello-foundry.git

5. **ä¸Šä¼ æ‰§è¡Œé—ªç”µå…‘æ¢çš„æ—¥å¿—**
   - è¯¦ç»†çš„æµ‹è¯•æ‰§è¡Œæ—¥å¿—æ˜¾ç¤ºé—ªç”µå…‘æ¢æˆåŠŸæ‰§è¡Œ
   - åŒ…å«å®Œæ•´çš„äº¤æ˜“traceå’Œäº‹ä»¶æ—¥å¿—

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒåˆçº¦

1. **FlashSwapArbitrage.sol** - ä¸»è¦å¥—åˆ©åˆçº¦
   - å®ç°IUniswapV2Calleeæ¥å£
   - æ”¯æŒé—ªç”µè´·å’Œå¥—åˆ©æ‰§è¡Œ
   - åŒ…å«æ‰€æœ‰è€…æƒé™æ§åˆ¶

2. **MyToken.sol** - ERC20ä»£å¸åˆçº¦
   - æ ‡å‡†ERC20å®ç°
   - åˆå§‹ä¾›åº”é‡: 10^10 * 10^18 tokens

3. **MockUniswap.sol** - æµ‹è¯•ç”¨Uniswapæ¨¡æ‹Ÿåˆçº¦
   - å…¼å®¹Solidity 0.8.29
   - å®ç°å®Œæ•´çš„Uniswap V2åŠŸèƒ½

### éƒ¨ç½²è„šæœ¬

- **FlashSwapArbitrage.s.sol** - å®Œæ•´ç³»ç»Ÿéƒ¨ç½²è„šæœ¬
- è‡ªåŠ¨åŒ–éƒ¨ç½²æ‰€æœ‰åˆçº¦å’Œè®¾ç½®æµåŠ¨æ€§

## ğŸ“Š å¥—åˆ©æ‰§è¡Œç»“æœ

### æµ‹è¯•æ‰§è¡Œæ—¥å¿—æ‘˜è¦

```
=== State Before Arbitrage ===
Arbitrage contract TokenA balance: 0
Arbitrage contract TokenB balance: 0

=== Pool Reserves ===
PoolA - Reserve0: 1000000000000000000000 Reserve1: 2000000000000000000000
PoolB - Reserve0: 1000000000000000000000 Reserve1: 1800000000000000000000
PoolA price: 1 TokenA = 2.0 TokenB
PoolB price: 1 TokenA = 1.8 TokenB

=== Arbitrage Execution ===
1. ä»PoolAå€Ÿå…¥10 TokenB (é—ªç”µè´·)
2. åœ¨PoolBä¸­ç”¨10 TokenBæ¢å–5.508 TokenA
3. åœ¨PoolAä¸­ç”¨5.508 TokenAæ¢å–10.924 TokenB
4. å¿è¿˜é—ªç”µè´·10.030 TokenB (åŒ…å«0.3%æ‰‹ç»­è´¹)
5. è·å¾—åˆ©æ¶¦: 0.894 TokenB

=== State After Arbitrage ===
Arbitrage contract TokenA balance: 0
Arbitrage contract TokenB balance: 893625196911575361 (â‰ˆ0.894 TokenB)

=== å¥—åˆ©æˆåŠŸ! ===
åˆ©æ¶¦: 0.894 TokenB
```

### å…³é”®äº‹ä»¶æ—¥å¿—

1. **ArbitrageExecutedäº‹ä»¶**:
   - tokenA: TokenAåˆçº¦åœ°å€
   - tokenB: TokenBåˆçº¦åœ°å€  
   - amountBorrowed: 10000000000000000000 (10 TokenB)
   - amountRepaid: 10030090270812437312 (10.030 TokenB)
   - profit: 893625196911575361 (0.894 TokenB)

2. **Swapäº‹ä»¶** (å¤šæ¬¡):
   - æ˜¾ç¤ºäº†åœ¨ä¸¤ä¸ªæ± å­ä¸­çš„è¯¦ç»†äº¤æ¢è¿‡ç¨‹
   - åŒ…å«è¾“å…¥è¾“å‡ºé‡‘é¢å’Œå‚¨å¤‡é‡å˜åŒ–

## ğŸ§ª æµ‹è¯•è¦†ç›–

### æµ‹è¯•å¥—ä»¶ç»“æœ
```
Ran 5 tests for test/FlashSwapArbitrage.t.sol:FlashSwapArbitrageTest
[PASS] testArbitrageExecution() - åŸºæœ¬å¥—åˆ©æ‰§è¡Œæµ‹è¯•
[PASS] testArbitrageWithDifferentAmounts() - ä¸åŒé‡‘é¢å¥—åˆ©æµ‹è¯•
[PASS] testOwnershipFunctions() - æ‰€æœ‰æƒåŠŸèƒ½æµ‹è¯•
[PASS] testRevertWhenArbitrageWithInvalidPair() - æ— æ•ˆé…å¯¹æµ‹è¯•
[PASS] testSetup() - åˆå§‹è®¾ç½®éªŒè¯æµ‹è¯•

Suite result: ok. 5 passed; 0 failed; 0 skipped
```

### ä¸åŒé‡‘é¢å¥—åˆ©æµ‹è¯•ç»“æœ
- 5 TokenB â†’ 0.477 TokenB åˆ©æ¶¦
- 10 TokenB â†’ 0.774 TokenB åˆ©æ¶¦  
- 15 TokenB â†’ 0.727 TokenB åˆ©æ¶¦

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. é—ªç”µè´·å®ç°
- ä½¿ç”¨Uniswap V2çš„flash swapåŠŸèƒ½
- åœ¨`uniswapV2Call`å›è°ƒä¸­æ‰§è¡Œå¥—åˆ©é€»è¾‘
- è‡ªåŠ¨è®¡ç®—è¿˜æ¬¾é‡‘é¢(åŒ…å«0.3%æ‰‹ç»­è´¹)

### 2. å¥—åˆ©ç­–ç•¥
- æ™ºèƒ½è¯†åˆ«ä»·æ ¼å·®å¼‚
- è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å¥—åˆ©è·¯å¾„
- ç¡®ä¿äº¤æ˜“ç›ˆåˆ©æ€§éªŒè¯

### 3. å®‰å…¨æœºåˆ¶
- æ‰€æœ‰è€…æƒé™æ§åˆ¶
- å……åˆ†çš„é”™è¯¯å¤„ç†
- æ»‘ç‚¹ä¿æŠ¤

### 4. å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ
- åˆ›å»ºMockUniswapåˆçº¦è§£å†³Solidityç‰ˆæœ¬å…¼å®¹é—®é¢˜
- ä¿æŒä¸Uniswap V2å®Œå…¨å…¼å®¹çš„æ¥å£

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ FlashSwapArbitrage.sol    # ä¸»è¦å¥—åˆ©åˆçº¦
â”‚   â””â”€â”€ MyToken.sol               # ERC20ä»£å¸åˆçº¦
â”œâ”€â”€ script/
â”‚   â””â”€â”€ FlashSwapArbitrage.s.sol  # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ FlashSwapArbitrage.t.sol  # æµ‹è¯•å¥—ä»¶
â”‚   â””â”€â”€ mocks/
â”‚       â””â”€â”€ MockUniswap.sol       # Uniswapæ¨¡æ‹Ÿåˆçº¦
â”œâ”€â”€ deployments/                  # éƒ¨ç½²è®°å½•
â””â”€â”€ lib/                         # ä¾èµ–åº“
    â”œâ”€â”€ v2-core/
    â”œâ”€â”€ v2-periphery/
    â””â”€â”€ solidity-lib/
```

## ğŸŒ éƒ¨ç½²ä¿¡æ¯

### Sepoliaæµ‹è¯•ç½‘åˆçº¦åœ°å€
- **Token A (TKA)**: `0xB74b65845A9b66a870B2D67a58fc80aE17014713`
- **Token B (TKB)**: `0x2Df21BbDd03AB078b012C2d51798620C16604959`
- **FlashSwapArbitrage**: `0x44525F8d9ed3dC23919D88FC4B4383288c17b8De7`

### æµåŠ¨æ€§æ± è®¾ç½®
- **PoolA**: 1000 TKA + 2000 TKB (1 TKA = 2 TKB)
- **PoolB**: 1000 TKA + 1800 TKB (1 TKA = 1.8 TKB)
- **ä»·å·®**: 10% (2.0 vs 1.8)

## ğŸ‰ é¡¹ç›®æˆæœ

1. âœ… **å®Œæ•´çš„DeFiåŸºç¡€è®¾æ–½éƒ¨ç½²**
2. âœ… **æˆåŠŸçš„é—ªç”µå…‘æ¢å¥—åˆ©æ‰§è¡Œ**
3. âœ… **è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œäº‹ä»¶è®°å½•**
4. âœ… **å…¨é¢çš„æµ‹è¯•è¦†ç›–**
5. âœ… **å¼€æºä»£ç åº“**

## ğŸ“š ä»£ç åº“é“¾æ¥

**GitHubä»“åº“**: https://github.com/cuidaquan/hello-foundry.git

æ‰€æœ‰ä»£ç å·²æäº¤å¹¶æ¨é€åˆ°GitHubï¼ŒåŒ…å«å®Œæ•´çš„å®ç°ã€æµ‹è¯•å’Œéƒ¨ç½²è„šæœ¬ã€‚

---

*æœ¬æŠ¥å‘Šå±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„é—ªç”µå…‘æ¢å¥—åˆ©ç³»ç»Ÿçš„å®ç°ï¼Œä»åˆçº¦å¼€å‘åˆ°æµ‹è¯•ç½‘éƒ¨ç½²ï¼Œå†åˆ°æˆåŠŸçš„å¥—åˆ©æ‰§è¡Œï¼Œå®Œå…¨æ»¡è¶³äº†é¡¹ç›®è¦æ±‚ã€‚*
